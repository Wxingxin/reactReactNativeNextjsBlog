ä¸‹é¢æŠŠ **React 19 çš„ `useActionState`** ç”¨**ä¼ä¸šçº§è§†è§’**ç»™ä½ è®²é€ï¼š
ğŸ‘‰ **å®ƒè§£å†³ä»€ä¹ˆé—®é¢˜**
ğŸ‘‰ **æ€ä¹ˆæ­£ç¡®ç”¨**
ğŸ‘‰ **å’Œ `useFormStatus` / RHF çš„è¾¹ç•Œ**
ğŸ‘‰ **ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ã€ä»€ä¹ˆæ—¶å€™ä¸è¯¥ç”¨**

---

## ä¸€å¥è¯å…ˆå®šæ€§ï¼ˆå…ˆè®°ä½ï¼‰

> **`useActionState` = Server Action çš„ã€ŒçŠ¶æ€æœº Hookã€**
> ç”¨æ¥ **ç®¡ç† Server Action çš„è¿”å›çŠ¶æ€ï¼ˆdata / error / pendingï¼‰**
> â—ä¸æ˜¯è¡¨å•æ ¡éªŒå·¥å…·
> â—ä¸æ˜¯ React Hook Form çš„æ›¿ä»£å“

---

## 1ï¸âƒ£ `useActionState` æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ

### å®˜æ–¹èƒ½åŠ›æ¨¡å‹

```ts
const [state, action, pending] = useActionState(
  actionFn,
  initialState
)
```

| è¿”å›å€¼       | è¯´æ˜                  |
| --------- | ------------------- |
| `state`   | Server Action è¿”å›çš„çŠ¶æ€ |
| `action`  | ç»‘å®šåˆ° form çš„ action   |
| `pending` | å½“å‰ action æ˜¯å¦æ‰§è¡Œä¸­     |

ğŸ‘‰ æœ¬è´¨ï¼š**æŠŠ Server Action å˜æˆå¯è¿½è¸ªçš„ reducer**

---

## 2ï¸âƒ£ æœ€å°å¯ç”¨ç¤ºä¾‹ï¼ˆNext.js / React 19ï¼‰

### Server Action

```ts
// app/actions/login.ts
"use server"

export async function loginAction(
  prevState: any,
  formData: FormData
) {
  await new Promise((r) => setTimeout(r, 800))

  const email = formData.get("email")

  if (email === "test@test.com") {
    return {
      ok: false,
      message: "è¯¥é‚®ç®±å·²è¢«å ç”¨",
      fieldErrors: {
        email: "é‚®ç®±å·²å­˜åœ¨",
      },
    }
  }

  return { ok: true }
}
```

---

### Client Component

```tsx
"use client"

import { useActionState } from "react"
import { loginAction } from "../actions/login"

const initialState = { ok: true }

export default function LoginForm() {
  const [state, formAction, pending] = useActionState(
    loginAction,
    initialState
  )

  return (
    <form action={formAction}>
      <input name="email" placeholder="é‚®ç®±" />

      {state.fieldErrors?.email && (
        <p style={{ color: "red" }}>{state.fieldErrors.email}</p>
      )}

      {state.message && (
        <p style={{ color: "red" }}>{state.message}</p>
      )}

      <button type="submit" disabled={pending}>
        {pending ? "æäº¤ä¸­..." : "ç™»å½•"}
      </button>
    </form>
  )
}
```

---

## 3ï¸âƒ£ `useActionState` vs `useFormStatus`ï¼ˆéå¸¸é‡è¦ï¼‰

| èƒ½åŠ›          | useActionState | useFormStatus |
| ----------- | -------------- | ------------- |
| ç®¡ç†è¿”å›æ•°æ®      | âœ…              | âŒ             |
| ç®¡ç†é”™è¯¯        | âœ…              | âŒ             |
| pending çŠ¶æ€  | âœ…              | âœ…             |
| è¡¨å•çº§ reducer | âœ…              | âŒ             |
| å¿…é¡»åœ¨ form å†…  | âŒ              | âœ…             |
| å¯è·¨ç»„ä»¶ä¼ é€’      | âœ…              | âŒ             |

ğŸ‘‰ **ç»“è®º**ï¼š

* `useFormStatus` â†’ åªå…³å¿ƒã€Œæ˜¯å¦æäº¤ä¸­ã€
* `useActionState` â†’ å…³å¿ƒã€Œæäº¤ç»“æœæ˜¯ä»€ä¹ˆã€

---

## 4ï¸âƒ£ å…¸å‹ä¼ä¸šçº§ä½¿ç”¨æ¨¡å¼ï¼ˆæ¨èï¼‰

### âœ… æ¨¡å¼ 1ï¼šå­—æ®µçº§é”™è¯¯ï¼ˆServer æ ¡éªŒï¼‰

```ts
return {
  ok: false,
  fieldErrors: {
    password: "å¯†ç é”™è¯¯",
  },
}
```

```tsx
{state.fieldErrors?.password}
```

ğŸ“Œ **è¿™å°±æ˜¯ React 19 åŸç”Ÿç‰ˆçš„â€œåç«¯æ ¡éªŒæ˜ å°„â€**

---

### âœ… æ¨¡å¼ 2ï¼šå…¨å±€é”™è¯¯ / æˆåŠŸæ€

```ts
return {
  ok: false,
  message: "ç™»å½•å¤±è´¥",
}
```

```tsx
{state.message}
```

---

### âœ… æ¨¡å¼ 3ï¼šçŠ¶æ€é©±åŠ¨ UIï¼ˆä¸æ˜¯ toastï¼‰

```tsx
if (state.ok) {
  return <Success />
}
```

---

## 5ï¸âƒ£ `useActionState` å’Œ RHF èƒ½ä¸€èµ·ç”¨å—ï¼Ÿ

### âŒ ä¸æ¨èç›´æ¥æ··ç”¨

```tsx
<form
  action={formAction}
  onSubmit={handleSubmit(onSubmit)}
>
```

ğŸ‘‰ **ä¸¤ä¸ªç³»ç»ŸæŠ¢ submit æ§åˆ¶æƒ**

---

### âœ… æ­£ç¡®åˆ†å·¥ï¼ˆä¼ä¸šçº§æ¨èï¼‰

| åœºæ™¯              | æ–¹æ¡ˆ               |
| --------------- | ---------------- |
| å¤æ‚å‰ç«¯æ ¡éªŒ          | RHF + API        |
| è½»è¡¨å• + Server æ ¡éªŒ | `useActionState` |
| å¼ºç±»å‹è¡¨å•           | RHF + Zod        |
| Next å†…éƒ¨ CRUD    | `useActionState` |

---

## 6ï¸âƒ£ ä»€ä¹ˆæ—¶å€™ã€Œåº”è¯¥ã€ç”¨ `useActionState`ï¼Ÿ

âœ” Next.js App Router
âœ” Server Actions æ˜¯ä¸»è·¯å¾„
âœ” è¡¨å•ç»“æ„ç®€å•
âœ” æ ¡éªŒä¸»è¦åœ¨æœåŠ¡ç«¯
âœ” ä¸æƒ³ç»´æŠ¤å¤§é‡å‰ç«¯çŠ¶æ€

âŒ ä¸é€‚åˆï¼š

* åŠ¨æ€è¡¨å•
* å¤šæ­¥éª¤è¡¨å•
* å¼ºäº¤äº’æ ¡éªŒ
* è¡¨å•æ•°ç»„ / åµŒå¥—

---

## 7ï¸âƒ£ é«˜çº§ï¼š`useActionState` = Reducer æ€ç»´

ä½ å¯ä»¥æŠŠå®ƒå½“æˆï¼š

```ts
const reducer = async (prevState, formData) => {
  // è¿”å› nextState
}
```

ğŸ“Œ **éå¸¸é€‚åˆ**

* ç™»å½•
* æ³¨å†Œ
* è®¾ç½®é¡µ
* ç®¡ç†åå° CRUD

---

## 8ï¸âƒ£ å¸¸è§è¸©å‘ï¼ˆå¿…çœ‹ï¼‰

### â— 1. initialState å¿…é¡»å®Œæ•´

```ts
const initialState = { ok: true }
```

### â— 2. Server Action ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ prevState

```ts
(prevState, formData)
```

### â— 3. ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºé”™è¯¯

ğŸ‘‰ æˆåŠŸåè¦è¿”å›å¹²å‡€ state

---

## æ€»ç»“ï¼ˆè®°ä½è¿™ 4 å¥è¯ï¼‰

1ï¸âƒ£ **`useActionState` æ˜¯ Server Action çš„çŠ¶æ€å®¹å™¨**
2ï¸âƒ£ **å®ƒè´Ÿè´£â€œç»“æœâ€ï¼Œä¸æ˜¯â€œæ ¡éªŒè¿‡ç¨‹â€**
3ï¸âƒ£ **å®ƒæ¯” `useFormStatus` å¼ºï¼Œä½†èŒè´£æ›´çª„**
4ï¸âƒ£ **å¤æ‚è¡¨å•ä»ç„¶ç”¨ RHF**

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥ç»™ä½ ï¼š

* âœ… **RHF + Zod vs useActionState çš„é€‰å‹æ¨¡æ¿**
* âœ… **ç™»å½• / æ³¨å†Œ / è®¾ç½®é¡µå®Œæ•´ Server Action æ¶æ„**
* âœ… **useActionState + optimistic UI å®æˆ˜**

ä½ ç°åœ¨æ˜¯åœ¨ **Next.js App Router + React 19** é¡¹ç›®é‡Œç”¨å—ï¼Ÿ
