
```jsx
export default function Contact() {
  const items = [
    { id: 1, name: "item 1" },
    { id: 2, name: "item 2" },
    { id: 3, name: "item 3" },
  ];
  const [itemList, setItemList] = useState(items);

  const handleClick = () => {
    setTimeout(() => {
      setItemList((pre) => {
        return [...pre, { id: pre.length + 1, name: `item ${pre.length + 1}` }];
      });
    }, 1500);
  };
  return (
    <div>
      <h1>Contact Page</h1>
      <button onClick={handleClick}>Add Item</button>
      <ul>
        {itemList.map((item) => (
          <li key={item.id}>{item.name}</li>
        ))}
      </ul>
    </div>
  );
}
```

```jsx
const handleClick = () => {
    setItemList(
      setTimeout(() => {
        (pre) => {
          return [
            ...pre,
            { id: pre.length + 1, name: `item ${pre.length + 1}` },
          ];
        };
      }, 1000),
    );
  };

```

```jsx
 const handleClick = () => {
    setItemList((pre) => {
      setTimeout(() => {
        return [...pre, { id: pre.length + 1, name: `item ${pre.length + 1}` }];
      }, 1000);
    });
  };
```

ä½ ç»™å‡ºçš„ **3 ç§ `handleClick` å†™æ³•ï¼Œæœ¬è´¨ä¸Šä»£è¡¨äº†å¯¹ `setState`ã€å‡½æ•°å¼æ›´æ–°ã€ä»¥åŠå¼‚æ­¥ APIï¼ˆ`setTimeout`ï¼‰ç†è§£ç¨‹åº¦çš„ä¸‰ä¸ªå±‚çº§**ã€‚ä¸‹é¢æˆ‘ä¼š**é€æ®µç²¾ç¡®åˆ†æ**ï¼šæ˜¯å¦æ­£ç¡®ã€ä¸ºä»€ä¹ˆã€å„è‡ªçš„ç‰¹ç‚¹ä¸é—®é¢˜åœ¨å“ªé‡Œã€‚

---

## ä¸€ã€ç¬¬ä¸€ç§ï¼ˆâœ… æ­£ç¡®ã€æ¨èå†™æ³•ï¼‰

```jsx
const handleClick = () => {
  setTimeout(() => {
    setItemList((pre) => {
      return [...pre, { id: pre.length + 1, name: `item ${pre.length + 1}` }];
    });
  }, 1500);
};
```

### æ ¸å¿ƒç‰¹ç‚¹

âœ” **å”¯ä¸€å®Œå…¨æ­£ç¡®çš„å†™æ³•**
âœ” æ­£ç¡®ä½¿ç”¨äº† **å‡½æ•°å¼æ›´æ–°**
âœ” æ­£ç¡®å¤„ç†äº† **å¼‚æ­¥å»¶è¿Ÿ**

---

### å…³é”®ç‚¹è§£æ

#### 1ï¸âƒ£ `setTimeout` åœ¨å¤–å±‚

```js
setTimeout(() => {
  setItemList(...)
}, 1500);
```

* `setTimeout` åªæ˜¯å»¶è¿Ÿæ‰§è¡Œ
* çœŸæ­£çš„ **çŠ¶æ€æ›´æ–°å‘ç”Ÿåœ¨å®šæ—¶å™¨å›è°ƒé‡Œ**

#### 2ï¸âƒ£ ä½¿ç”¨å‡½æ•°å¼æ›´æ–° `(pre) => {}`

```js
setItemList((pre) => ...)
```

* `pre` æ°¸è¿œæ˜¯ **æœ€æ–°çš„ state**
* é¿å… **é—­åŒ…å¯¼è‡´çš„æ—§çŠ¶æ€é—®é¢˜**
* åœ¨å¼‚æ­¥åœºæ™¯ï¼ˆå®šæ—¶å™¨ã€Promiseã€äº‹ä»¶å›è°ƒï¼‰ä¸­ **å¿…é¡»ä½¿ç”¨**

#### 3ï¸âƒ£ é€»è¾‘æ¸…æ™°ã€è¯­ä¹‰æ­£ç¡®

* å®šæ—¶å™¨è´Ÿè´£â€œä»€ä¹ˆæ—¶å€™æ‰§è¡Œâ€
* `setItemList` è´Ÿè´£â€œå¦‚ä½•æ›´æ–° stateâ€

---

### æ€»ç»“ä¸€å¥è¯

> **è¿™æ˜¯ React å®˜æ–¹æ¨èã€ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€100% å®‰å…¨çš„å†™æ³•**

---

## äºŒã€ç¬¬äºŒç§ï¼ˆâŒ è¯­æ³• + é€»è¾‘åŒé‡é”™è¯¯ï¼‰

```jsx
const handleClick = () => {
  setItemList(
    setTimeout(() => {
      (pre) => {
        return [
          ...pre,
          { id: pre.length + 1, name: `item ${pre.length + 1}` },
        ];
      };
    }, 1000),
  );
};
```

### é—®é¢˜éå¸¸ä¸¥é‡ï¼ˆä¸æ˜¯â€œå†™æ³•ä¸å¥½â€ï¼Œè€Œæ˜¯**å®Œå…¨é”™è¯¯**ï¼‰

---

### âŒ é—®é¢˜ 1ï¼š`setItemList` è¢«ä¼ å…¥äº† `setTimeout` çš„è¿”å›å€¼

```js
setItemList(setTimeout(...))
```

* `setTimeout(...)` çš„è¿”å›å€¼æ˜¯ **å®šæ—¶å™¨ IDï¼ˆnumberï¼‰**
* ç­‰ä»·äºï¼š

```js
setItemList(1); // æˆ– 2ã€3â€¦â€¦
```

ğŸ‘‰ **state ä¼šè¢«è®¾ç½®æˆä¸€ä¸ªæ•°å­—**

---

### âŒ é—®é¢˜ 2ï¼š `(pre) => {}` æ ¹æœ¬æ²¡æœ‰è¢«æ‰§è¡Œ

```js
setTimeout(() => {
  (pre) => { ... };
}, 1000);
```

* è¿™æ˜¯ä¸€ä¸ª **å­¤ç«‹çš„ç®­å¤´å‡½æ•°**
* æ—¢æ²¡æœ‰è¿”å›
* ä¹Ÿæ²¡æœ‰ä¼ ç»™ `setItemList`
* React **å®Œå…¨ä¸çŸ¥é“å®ƒçš„å­˜åœ¨**

---

### âŒ é—®é¢˜ 3ï¼šReact State API ä½¿ç”¨æ¦‚å¿µæ··ä¹±

ä½ æ··æ·†äº†ï¼š

| API            | èŒè´£         |
| -------------- | ---------- |
| `setTimeout`   | å»¶è¿Ÿæ‰§è¡Œ       |
| `setItemList`  | æ›´æ–° state   |
| `(pre) => ...` | state è®¡ç®—å‡½æ•° |

---

### ç»“è®º

> âŒ **è¿™æ˜¯ä¸€ä¸ªâ€œçœ‹èµ·æ¥åƒ Reactï¼Œå®é™…ä¸Šå®Œå…¨ä¸æ˜¯ React çš„å†™æ³•â€**

---

## ä¸‰ã€ç¬¬ä¸‰ç§ï¼ˆâŒ æ€æƒ³æ¥è¿‘ï¼Œä½†ä»ç„¶é”™è¯¯ï¼‰

```jsx
const handleClick = () => {
  setItemList((pre) => {
    setTimeout(() => {
      return [...pre, { id: pre.length + 1, name: `item ${pre.length + 1}` }];
    }, 1000);
  });
};
```

### è¿™æ˜¯ä¸€ä¸ª**éå¸¸å¸¸è§çš„åˆå­¦è€…è¯¯åŒº**

---

### âŒ æ ¸å¿ƒé—®é¢˜ï¼š`setItemList` çš„å›è°ƒ **å¿…é¡»åŒæ­¥è¿”å›æ–° state**

```js
setItemList((pre) => {
  // React æœŸå¾…è¿™é‡Œ return æ–° state
});
```

ä½†æ˜¯ä½ å†™çš„æ˜¯ï¼š

```js
setTimeout(() => {
  return [...pre, ...];
}, 1000);
```

ğŸ‘‰ **è¿™ä¸ª `return` åªè¿”å›ç»™ `setTimeout`ï¼Œä¸æ˜¯è¿”å›ç»™ React**

---

### å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

```js
setItemList((pre) => {
  // æ²¡æœ‰ return
});
```

ç­‰ä»·äºï¼š

```js
setItemList(() => undefined);
```

âš ï¸ React ä¼šæŠŠ state è®¾ä¸º `undefined`

---

### âŒ å…³é”®è§„åˆ™ï¼ˆå¿…é¡»è®°ä½ï¼‰

> **`setState((prev) => ...)` å›è°ƒå¿…é¡»æ˜¯ï¼š**
>
> * åŒæ­¥çš„
> * ç«‹å³è¿”å›æ–° state
> * ä¸èƒ½åŒ…å«å¼‚æ­¥é€»è¾‘

---

## å››ã€ä¸‰ç§å†™æ³•å¯¹æ¯”æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰

| å†™æ³•  | æ˜¯å¦æ­£ç¡®   | é—®é¢˜æœ¬è´¨                   |
| --- | ------ | ---------------------- |
| ç¬¬ä¸€ç§ | âœ… æ­£ç¡®   | æ¨èã€æ ‡å‡†ã€å¯ç»´æŠ¤              |
| ç¬¬äºŒç§ | âŒ å®Œå…¨é”™è¯¯ | æŠŠ `setTimeout` å½“ state |
| ç¬¬ä¸‰ç§ | âŒ é€»è¾‘é”™è¯¯ | å¼‚æ­¥ return ä¸ç”Ÿæ•ˆ          |

---

## äº”ã€å¿…é¡»å½¢æˆçš„ React å¿ƒæ™ºæ¨¡å‹ï¼ˆéå¸¸é‡è¦ï¼‰

### âœ… æ­£ç¡®æ¨¡å‹

```txt
å¼‚æ­¥é€»è¾‘ï¼ˆsetTimeout / Promiseï¼‰
        â†“
åœ¨å›è°ƒé‡Œè°ƒç”¨ setState
        â†“
setState å†…éƒ¨æ˜¯åŒæ­¥è®¡ç®—
```

### âŒ é”™è¯¯æ¨¡å‹

```txt
setState(() => {
  setTimeout(...)
})
```

---

## å…­ã€æœ€ç»ˆä¸€å¥æ€»ç»“ï¼ˆè¯·è®°ç‰¢ï¼‰

> **React çš„ state æ›´æ–°å‡½æ•°æ˜¯â€œåŒæ­¥è®¡ç®—å™¨â€ï¼Œ
> æ‰€æœ‰å¼‚æ­¥é€»è¾‘å¿…é¡»æ”¾åœ¨å®ƒå¤–é¢ã€‚**

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ æŠŠè¿™ä¸ªä¾‹å­ **å‡çº§åˆ° React Query / è‡ªå®šä¹‰ Hook / useEffect åœºæ™¯**ï¼Œè®©ä½ å½»åº•åƒé€è¿™ä¸€ç±»é—®é¢˜ã€‚
